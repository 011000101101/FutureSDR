<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />

    <link data-trunk rel="copy-file" href="./assets/android-chrome-96x96.png" />
    <link data-trunk rel="copy-file" href="./assets/apple-touch-icon.png" />
    <link data-trunk rel="copy-file" href="./assets/browserconfig.xml" />
    <link data-trunk rel="copy-file" href="./assets/favicon-16x16.png" />
    <link data-trunk rel="copy-file" href="./assets/favicon-32x32.png" />
    <link data-trunk rel="copy-file" href="./assets/favicon.ico" />
    <link data-trunk rel="copy-file" href="./assets/mstile-150x150.png" />
    <link data-trunk rel="copy-file" href="./assets/safari-pinned-tab.svg" />
    <link data-trunk rel="copy-file" href="./assets/site.webmanifest" />
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5" />
    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="theme-color" content="#ffffff" />

    <!-- <link data-trunk rel="rust" data-bin="wasm-rx" data-cargo-no-default-features data-keep-debug data-wasm-opt="0"> -->
    <link data-trunk rel="rust" data-bin="wasm-rx" data-cargo-no-default-features>

    <title>FutureSDR :: ZigBee Transceiver</title>
  </head>
  <body>
    <button id="start" type="button" value="Start">Start</button>

    <div>
      Received Frames:
      <div id="log">
      </div>
    </div>

    <script type="module">
     import init, {run_fg} from "./wasm-rx.js"

     const runWasm = async () => {
         const rustWasm = await init();
     };


     runWasm();

     document.getElementById('start').onclick = run_fg

     </script>
    <script>
      var logger = document.getElementById('log');
      var rxed_frame = function(payload) {
        <!-- console.log(payload); -->
        var result = "";

        result += "frame control: 0x";
        result += (payload[1] * 256 + payload[0]).toString(16);
        result += " | seq nr: ";
        result += payload[2];
        result += " | dst pan: 0x";
        result += (payload[4] * 256 + payload[3]).toString(16);
        result += " | dst addr: 0x";
        result += (payload[6] * 256 + payload[5]).toString(16);
        /* result += " | src addr: 0x";
                    * result += (payload[8] * 256 + payload[7]).toString(16); */
        result += " | payload ";
        for (var i = 7; i < payload.length - 2; i++) {
          result += String.fromCharCode(payload[i]);
        }
        result += " | crc : 0x";
        result += (payload[payload.length-1] * 256 + payload[payload.length-2]).toString(16);
        console.log(result);
        logger.innerHTML += result + '<br />';
      };
      </script>
  </body>
</html>
